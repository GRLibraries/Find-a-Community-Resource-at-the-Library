<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Community Resource Map</title>
    
    <!-- Leaflet.js CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
     
    <!-- Leaflet.js JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <!-- QR Code Generator Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator/qrcode.js"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* --- Brand Colors --- */
        :root {
            --bg-color: #F9FAFB;
            --panel-bg: #FFFFFF;
            --primaryTeal: #00A99D;
            --darkTeal: #007A70;
            --lightTealBackground: #E0F2F1;
            --darkGreyText: #374151;
            --mediumGrey: #6B7280;
            --lightGrey: #D1D5DB;
            --text-colour: #111827;
            --active-text: #FFFFFF;
        }

        /* --- Base & Typography --- */
        body {
            font-family: 'Work Sans', sans-serif;
            background-color: var(--bg-color);
            color: var(--darkGreyText);
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* --- Main App Layout --- */
        .app-layout {
            display: flex;
            height: 100vh;
            padding: 1.5rem;
            gap: 1.5rem;
        }

        /* --- Controls Panel (Left Side) --- */
        .controls-panel {
            width: 420px; /* Increased width */
            flex-shrink: 0;
            background-color: var(--panel-bg);
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.04);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .panel-header {
            background-color: var(--darkTeal);
            padding: 1.25rem; /* Reduced padding */
            text-align: center;
        }

        .header-logo {
            height: 60px; /* Reduced logo size */
            width: auto;
            object-fit: contain;
        }
        
        .panel-body {
            padding: 1.25rem; /* Reduced padding */
        }

        /* --- Page Title Styles --- */
        .page-title {
            text-align: left;
            margin-bottom: 3rem; /* Increased margin to prevent overlap */
            height: 95px; /* Increased height to prevent layout shifts */
        }

        .page-title h1 {
            font-size: 2rem; /* Reduced font size */
            font-weight: 800;
            line-height: 1.1; /* Tighter line spacing */
            color: var(--text-colour);
            margin: 0;
        }

        .page-title .highlight {
            color: var(--darkTeal); 
        }
        
        .page-title .subtitle {
            color: var(--text-colour);
        }
        
        #scrolling-category {
            transition: opacity 0.5s ease-in-out;
        }

        /* --- Filter Styles --- */
        .filter-section {
            display: flex;
            flex-direction: column;
            gap: 1.5rem; /* Reduced gap */
        }
        
        .filter-group {
            text-align: left;
        }

        .filter-heading {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--darkTeal);
            margin-bottom: 0.75rem; /* Reduced margin */
        }

        /* --- Unified Button Styles --- */
        .button-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem; /* Reduced gap */
        }

        .filter-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.6rem 1rem; /* Reduced padding */
            border: none;
            cursor: pointer;
            background-color: #f1f3f4;
            color: #3c4043;
            border-radius: 20px;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            line-height: 1.3;
            text-align: center;
        }

        .filter-button .lang-native {
            font-weight: 600;
            font-size: 0.9rem; /* Reduced font size */
        }

        .filter-button .lang-main {
            font-size: 0.7rem; /* Reduced font size */
            font-weight: 500;
            opacity: 0.9;
        }
        
        .filter-button.single-line {
             padding: 0.4rem 0.8rem;
        }

        .filter-button.single-line .lang-main {
            font-size: 0.75rem;
            font-weight: 600;
            opacity: 1;
        }

        .filter-button:not(.active):hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .filter-button.active {
            background-color: #00A99D;
        }
        
        .filter-button.active .lang-native,
        .filter-button.active .lang-main {
            color: white;
            opacity: 1;
        }
        
        #community-filters.button-grid {
            gap: 0.4rem;
        }
        
        #community-filters .filter-button {
            padding: 0.3rem 0.7rem; /* Further reduced padding */
        }

        #community-filters .filter-button .lang-main {
            font-size: 0.7rem; /* Further reduced font size */
        }

        /* --- Main Panel (Right Side) --- */
        .main-panel {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            min-width: 0; /* Prevents flexbox overflow issues */
        }

        /* --- Map Container --- */
        .map-container {
            height: 60%; /* Map takes 60% of the vertical space */
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.04);
            overflow: hidden;
        }
        #map {
            width: 100%;
            height: 100%;
            background-color: #f0f0f0;
        }

        /* --- Organisation List Container --- */
        .list-container {
            height: 40%; /* List takes 40% of the vertical space */
            background-color: var(--panel-bg);
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.04);
            display: flex;
            flex-direction: column;
        }
        
        .list-container h2 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--darkTeal);
            padding: 1rem 1.5rem;
            margin: 0;
            border-bottom: 1px solid var(--lightTealBackground);
            flex-shrink: 0;
        }

        #organisation-list {
            list-style: none;
            padding: 0;
            margin: 0;
            overflow-y: auto;
            padding: 1rem 1.5rem;
        }

        .organisation-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #eee;
        }
        
        .organisation-item:last-child {
            border-bottom: none;
        }
        
        .item-details {
            flex-grow: 1;
        }

        .organisation-item h3 {
            margin: 0 0 0.5rem 0;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .organisation-item p {
            margin: 0.25rem 0;
            font-size: 0.85rem;
            color: var(--mediumGrey);
        }
        
        .organisation-item .item-description {
            font-style: italic;
            margin-bottom: 0.75rem;
        }
        
        .item-qr-code {
            flex-shrink: 0;
            margin-left: 1rem;
        }
        
        .item-qr-code img {
            width: 80px;
            height: 80px;
        }

        /* --- Leaflet Popup Styling --- */
        .leaflet-popup-content-wrapper {
            border-radius: 8px;
        }
        .leaflet-popup-content {
            width: 280px !important;
        }
        .leaflet-popup-content h3 {
            margin: 0 0 0.5rem;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--darkTeal);
        }
        .leaflet-popup-content .popup-description {
            margin: 0 0 1rem 0;
            line-height: 1.5;
            font-size: 0.9rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 1rem;
        }
        .popup-details {
            margin-top: 1rem;
        }
        .popup-details p {
            margin: 0.25rem 0;
            font-size: 0.85rem;
        }
        .popup-details strong {
            color: var(--darkGreyText);
        }
        .popup-qr-code {
            margin-top: 1rem;
            text-align: center;
        }
        .popup-qr-code img {
            width: 120px;
            height: 120px;
        }
        
    </style>
</head>
<body>

    <div class="app-layout">
        <div class="controls-panel">
            <header class="panel-header">
                <img src="https://georgesriver.spydus.com/api/maintenance/1.0/imagebrowser/image?blobName=a31cf63f-7e24-41d5-b1f8-c206bde45ce6.png" alt="Georges River Libraries Logo" class="header-logo">
            </header>
            <div class="panel-body">
                <div class="page-title">
                    <h1>
                        <span data-translate-key="titleFind">Find </span><span id="scrolling-category" class="highlight"></span> <span data-translate-key="titleResources" class="subtitle">resources</span><br>
                        <span data-translate-key="titleAtTheLibrary" class="subtitle">at the library</span>
                    </h1>
                </div>
                
                <div class="filter-section">
                    <div class="filter-group">
                        <div class="filter-heading" data-translate-key="headingSelectLanguage">Select your language:</div>
                        <div id="language-filters" class="button-grid">
                            <button class="filter-button active single-line" data-filter="English">
                                <span class="lang-main">English</span>
                            </button>
                            <button class="filter-button" data-filter="Mandarin">
                                <span class="lang-native">普通话</span>
                                <span class="lang-main">Mandarin</span>
                            </button>
                            <button class="filter-button" data-filter="Cantonese">
                                <span class="lang-native">粤语</span>
                                <span class="lang-main">Cantonese</span>
                            </button>
                            <button class="filter-button" data-filter="Nepali">
                                <span class="lang-native">नेपाली</span>
                                <span class="lang-main">Nepali</span>
                            </button>
                            <button class="filter-button" data-filter="Italian">
                                <span class="lang-native">Italiano</span>
                                <span class="lang-main">Italian</span>
                            </button>
                            <button class="filter-button" data-filter="Greek">
                                <span class="lang-native">Ελληνικά</span>
                                <span class="lang-main">Greek</span>
                            </button>
                        </div>
                    </div>
                    <div class="filter-group">
                        <div class="filter-heading" data-translate-key="headingChooseCategory">Choose a Category:</div>
                        <div id="community-filters" class="button-grid">
                            <button class="filter-button active single-line" data-filter="First Nations"><span class="lang-main" data-translate-key="catFirstNations">First Nations</span></button>
                            <button class="filter-button single-line" data-filter="Arts"><span class="lang-main" data-translate-key="catArts">Arts</span></button>
                            <button class="filter-button single-line" data-filter="Carers Support Services"><span class="lang-main" data-translate-key="catCarers">Carers Support Services</span></button>
                            <button class="filter-button single-line" data-filter="Children & Families"><span class="lang-main" data-translate-key="catChildrenFamilies">Children & Families</span></button>
                            <button class="filter-button single-line" data-filter="Community Support"><span class="lang-main" data-translate-key="catCommunitySupport">Community Support</span></button>
                            <button class="filter-button single-line" data-filter="Disability Services"><span class="lang-main" data-translate-key="catDisability">Disability Services</span></button>
                            <button class="filter-button single-line" data-filter="Domestic Violence"><span class="lang-main" data-translate-key="catDomesticViolence">Domestic Violence</span></button>
                            <button class="filter-button single-line" data-filter="Drug & Alcohol"><span class="lang-main" data-translate-key="catDrugAlcohol">Drug & Alcohol</span></button>
                            <button class="filter-button single-line" data-filter="Education, Training & Employment"><span class="lang-main" data-translate-key="catEducation">Education, Training & Employment</span></button>
                            <button class="filter-button single-line" data-filter="Food & Emergency Support"><span class="lang-main" data-translate-key="catFood">Food & Emergency Support</span></button>
                            <button class="filter-button single-line" data-filter="Government Departments"><span class="lang-main" data-translate-key="catGovernment">Government Departments</span></button>
                            <button class="filter-button single-line" data-filter="Health & Wellbeing"><span class="lang-main" data-translate-key="catHealth">Health & Wellbeing</span></button>
                            <button class="filter-button single-line" data-filter="Housing & Homelessness"><span class="lang-main" data-translate-key="catHousing">Housing & Homelessness</span></button>
                            <button class="filter-button single-line" data-filter="Legal Support"><span class="lang-main" data-translate-key="catLegal">Legal Support</span></button>
                            <button class="filter-button single-line" data-filter="LGBTQIA+"><span class="lang-main" data-translate-key="catLgbtqia">LGBTQIA+</span></button>
                            <button class="filter-button single-line" data-filter="Multicultural"><span class="lang-main" data-translate-key="catMulticultural">Multicultural</span></button>
                            <button class="filter-button single-line" data-filter="Police & Emergency Services"><span class="lang-main" data-translate-key="catPolice">Police & Emergency Services</span></button>
                            <button class="filter-button single-line" data-filter="Seniors"><span class="lang-main" data-translate-key="catSeniors">Seniors</span></button>
                            <button class="filter-button single-line" data-filter="Transport"><span class="lang-main" data-translate-key="catTransport">Transport</span></button>
                            <button class="filter-button single-line" data-filter="Youth"><span class="lang-main" data-translate-key="catYouth">Youth</span></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="main-panel">
            <div class="map-container">
                <div id="map"></div>
            </div>
            <div class="list-container">
                <h2 id="list-header" data-translate-key="listHeader">Service Directory</h2>
                <ul id="organisation-list"></ul>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STRUCTURES ---
            const partners = [
                // First Nations
                { name: "Kurranulla Aboriginal Corporation", lat: -34.053, lng: 151.06, community: "First Nations", languages: ["English"], description: { English: "Provides services and programs for the local Aboriginal community.", Mandarin: "为当地原住民社区提供服务和项目。", Greek: "Παρέχει υπηρεσίες και προγράμματα για την τοπική κοινότητα των Αβοριγίνων.", Cantonese: "為當地原住民社區提供服務和計劃。", Nepali: "स्थानीय आदिवासी समुदायका लागि सेवा र कार्यक्रमहरू प्रदान गर्दछ।", Italian: "Fornisce servizi e programmi per la comunità aborigena locale." }, address: "15 Jannali Avenue, Jannali", phone: "(02) 9528 0287", email: "contact@kurranulla.org.au", website: "https://www.kurranulla.org.au/" },
                { name: "Metropolitan Local Aboriginal Land Council", lat: -33.874, lng: 151.21, community: "First Nations", languages: ["English"], description: { English: "Advocates for Aboriginal people in the Sydney metropolitan area.", Mandarin: "为悉尼大都会区的原住民提供支持。", Greek: "Υποστηρίζει τους Αβορίγινες στην μητροπολιτική περιοχή του Σίδνεϊ.", Cantonese: "為悉尼大都會區的原住民提供支援。", Nepali: "सिड्नी महानगरीय क्षेत्रमा आदिवासीहरूका लागि वकालत गर्दछ।", Italian: "Sostiene le persone aborigene nell'area metropolitana di Sydney." }, address: "Level 2, 150 Elizabeth St Sydney", phone: "(02) 8394 9666", email: "metrolalc@metrolalc.org.au", website: "https://metrolalc.org.au/" },
                { name: "3Bridges Burrbangana Program", lat: -33.973, lng: 151.09, community: "First Nations", languages: ["English"], description: { English: "Youth mentoring and indigenous learning programs.", Mandarin: "青年辅导和土著学习项目。", Greek: "Προγράμματα καθοδήγησης νέων και ιθαγενών μάθησης.", Cantonese: "青年指導同原住民學習計劃。", Nepali: "युवा मार्गदर्शन र आदिवासी शिक्षा कार्यक्रमहरू।", Italian: "Programmi di mentoring giovanile e di apprendimento indigeno." }, address: "643A King Georges Road, Penshurst", phone: "1300 327 434", email: "admin@3bridges.org.au", website: "https://3bridges.org.au/" },
                { name: "BlaQ Aboriginal Corporation", lat: -33.895, lng: 151.203, community: "First Nations", languages: ["English"], description: { English: "Supports the Aboriginal and Torres Strait Islander LGBTQIA+ community.", Mandarin: "支持原住民和托雷斯海峡岛民 LGBTQIA+ 社区。", Greek: "Υποστηρίζει την κοινότητα LGBTQIA+ των Αβοριγίνων και των Νησιωτών του Πορθμού Τόρες.", Cantonese: "支持原住民同托雷斯海峽島民 LGBTQIA+ 社區。", Nepali: "आदिवासी र टोरेस स्ट्रेट आइल्याण्डर LGBTQIA+ समुदायलाई समर्थन गर्दछ।", Italian: "Sostiene la comunità LGBTQIA+ aborigena e delle isole dello Stretto di Torres." }, address: "Redfern, NSW, Australia 2060", phone: "0490 420 900", email: "admin@blaq.org.au", website: "https://blaq.org.au/" },
                { name: "Aboriginal Medical Service (AMS)", lat: -33.891, lng: 151.204, community: "First Nations", languages: ["English"], description: { English: "Provides comprehensive primary healthcare services.", Mandarin: "提供全面的初级医疗保健服务。", Greek: "Παρέχει ολοκληρωμένες υπηρεσίες πρωτοβάθμιας υγειονομικής περίθαλψης.", Cantonese: "提供全面嘅基層醫療服務。", Nepali: "व्यापक प्राथमिक स्वास्थ्य सेवाहरू प्रदान गर्दछ।", Italian: "Fornisce servizi sanitari primari completi." }, address: "36 Turner Street, Redfern", phone: "(02) 9319 5823", email: "amsredfern@amsredfern.org.au", website: "https://amsredfern.org.au/" },
                { name: "Aboriginal Legal Service NSW (ALS)", lat: -33.892, lng: 151.206, community: "First Nations", languages: ["English"], description: { English: "Offers legal services to Aboriginal and Torres Strait Islander people.", Mandarin: "为原住民和托雷斯海峡岛民提供法律服务。", Greek: "Προσφέρει νομικές υπηρεσίες σε Αβορίγινες και Νησιώτες του Πορθμού Τόρες.", Cantonese: "為原住民同托雷斯海峽島民提供法律服務。", Nepali: "आदिवासी र टोरेस स्ट्रेट आइल्याण्डर मानिसहरूलाई कानूनी सेवाहरू प्रदान गर्दछ।", Italian: "Offre servizi legali alle persone aborigene e delle isole dello Stretto di Torres." }, address: "261-265 Chalmers St, Level 3, Redfern", phone: "(02) 8303 6600", email: "redfern@alsnswact.org.au", website: "https://www.alsnswact.org.au/" },
                // Arts
                { name: "Shopfront Arts Co-op", lat: -33.9545, lng: 151.1215, community: "Arts", languages: ["English"], description: { English: "A space for young people to create and experience art.", Mandarin: "一个让年轻人创作和体验艺术的空间。", Greek: "Ένας χώρος για νέους να δημιουργήσουν και να βιώσουν την τέχνη.", Cantonese: "一個俾年輕人創作同體驗藝術嘅空間。", Nepali: "युवाहरूलाई कला सिर्जना गर्न र अनुभव गर्नका लागि एउटा ठाउँ।", Italian: "Uno spazio per i giovani per creare e sperimentare l'arte." }, address: "88 Carlton Parade, Carlton", phone: "(02) 9588 3948", email: "hello@shopfront.org.au", website: "https://shopfront.org.au/" },
                { name: "Bus Stop Films", lat: -33.9545, lng: 151.1215, community: "Arts", languages: ["English"], description: { English: "An accessible film studies program for people with disabilities.", Mandarin: "为残疾人士提供的无障碍电影研究项目。", Greek: "Ένα προσβάσιμο πρόγραμμα σπουδών κινηματογράφου για άτομα με αναπηρίες.", Cantonese: "一個為殘疾人士而設嘅無障礙電影研究課程。", Nepali: "अपाङ्गता भएका व्यक्तिहरूका लागि पहुँचयोग्य चलचित्र अध्ययन कार्यक्रम।", Italian: "Un programma di studi cinematografici accessibile per persone con disabilità." }, address: "86-88 Carlton Parade, Carlton", phone: "(02) 7204 5010", email: "hello@busstopfilms.com.au", website: "https://www.busstopfilms.com.au/" },
                // Carers Support Services
                { name: "Carers NSW", lat: -33.8394, lng: 151.2081, community: "Carers Support Services", languages: ["English"], description: { English: "The peak non-government organisation for carers in NSW.", Mandarin: "新南威尔士州照顾者的最高非政府组织。", Greek: "Ο κορυφαίος μη κυβερνητικός οργανισμός για φροντιστές στη ΝΝΟ.", Cantonese: "新南威爾士州照顧者嘅最高非政府組織。", Nepali: "NSW मा हेरचाहकर्ताहरूका लागि शिखर गैर-सरकारी संस्था।", Italian: "La principale organizzazione non governativa per i caregiver nel NSW." }, address: "Level 10/213 Miller St, North Sydney", phone: "(02) 9280 4744", email: "contact@carersnsw.org.au", website: "https://www.carersnsw.org.au/" },
                // Children & Families
                { name: "Tresillian", lat: null, lng: null, community: "Children & Families", languages: ["English"], description: { English: "Early parenting support for families with young children.", Mandarin: "为有幼儿的家庭提供早期育儿支持。", Greek: "Υποστήριξη πρώιμης γονικής μέριμνας για οικογένειες με μικρά παιδιά.", Cantonese: "為有幼兒嘅家庭提供早期育兒支援。", Nepali: "साना बच्चाहरू भएका परिवारहरूका लागि प्रारम्भिक अभिभावकत्व समर्थन।", Italian: "Supporto alla genitorialità precoce per famiglie con bambini piccoli." }, address: "Online & Phone Support", phone: "1300 272 736", email: "N/A", website: "https://www.tresillian.org.au/" },
                { name: "Barnardos Australia", lat: null, lng: null, community: "Children & Families", languages: ["English"], description: { English: "Family support and out-of-home care services.", Mandarin: "家庭支持和家庭外照顾服务。", Greek: "Υπηρεσίες υποστήριξης της οικογένειας και φροντίδας εκτός σπιτιού.", Cantonese: "家庭支援同家庭外照顧服務。", Nepali: "पारिवारिक समर्थन र घर बाहिर हेरचाह सेवाहरू।", Italian: "Supporto familiare e servizi di assistenza fuori casa." }, address: "Various Locations", phone: "1800 066 757", email: "familyconnectandsupport@barnardos.org.au", website: "https://www.barnardos.org.au/" },
                { name: "St George Child and Family Health", lat: -33.968, lng: 151.135, community: "Children & Families", languages: ["English"], description: { English: "Health services for children and families in the local area.", Mandarin: "为当地儿童和家庭提供健康服务。", Greek: "Υπηρεσίες υγείας για παιδιά και οικογένειες στην τοπική περιοχή.", Cantonese: "為當地兒童同家庭提供健康服務。", Nepali: "स्थानीय क्षेत्रमा बालबालिका र परिवारका लागि स्वास्थ्य सेवाहरू।", Italian: "Servizi sanitari per bambini e famiglie nell'area locale." }, address: "St George Hospital Campus", phone: "1800 066 757", email: "N/A", website: "https://www.seslhd.health.nsw.gov.au/st-george-hospital" },
                { name: "St George Family Support Services", lat: -33.959, lng: 151.129, community: "Children & Families", languages: ["English"], description: { English: "Provides support to vulnerable children, young people, and families.", Mandarin: "为弱势儿童、青少年和家庭提供支持。", Greek: "Παρέχει υποστήριξη σε ευάλωτα παιδιά, νέους και οικογένειες.", Cantonese: "為弱勢兒童、青少年同家庭提供支援。", Nepali: "विपन्न बालबालिका, युवा र परिवारलाई सहयोग प्रदान गर्दछ।", Italian: "Fornisce supporto a bambini, giovani e famiglie vulnerabili." }, address: "42 Jubilee Avenue, Carlton", phone: "(02) 9553 9100", email: "information@sgfss.org.au", website: "https://www.sgfss.org.au/" },
                // Community Support
                { name: "Kingsgrove Community Aid Centre", lat: -33.948, lng: 151.085, community: "Community Support", languages: ["English"], description: { English: "Provides a range of services to support the local community.", Mandarin: "提供一系列服务以支持当地社区。", Greek: "Παρέχει μια σειρά υπηρεσιών για την υποστήριξη της τοπικής κοινότητας.", Cantonese: "提供一系列服務以支援當地社區。", Nepali: "स्थानीय समुदायलाई सहयोग गर्न विभिन्न सेवाहरू प्रदान गर्दछ।", Italian: "Fornisce una gamma di servizi a supporto della comunità locale." }, address: "30 Morgan Street, Kingsgrove", phone: "(02) 9150 2823", email: "admin@kcac.org.au", website: "https://www.kcac.org.au/" },
                { name: "3Bridges Community", lat: -33.973, lng: 151.09, community: "Community Support", languages: ["English"], description: { English: "Offers a wide range of services for all ages and cultures.", Mandarin: "为所有年龄和文化的人提供广泛的服务。", Greek: "Προσφέρει ένα ευρύ φάσμα υπηρεσιών για όλες τις ηλικίες και τους πολιτισμούς.", Cantonese: "為所有年齡同文化嘅人提供廣泛嘅服務。", Nepali: "सबै उमेर र संस्कृतिहरूका लागि विस्तृत सेवाहरू प्रदान गर्दछ।", Italian: "Offre una vasta gamma di servizi per tutte le età e culture." }, address: "643/643A King Georges Road, Penshurst", phone: "1300 327 434", email: "admin@3bridges.org.au", website: "https://3bridges.org.au/" },
                // Disability Services
                { name: "Northcott", lat: -33.967, lng: 151.104, community: "Disability Services", languages: ["English"], description: { English: "Supports people with disability to live the life they choose.", Mandarin: "支持残疾人士过上他们选择的生活。", Greek: "Υποστηρίζει άτομα με αναπηρία να ζήσουν τη ζωή που επιλέγουν.", Cantonese: "支持殘疾人士過佢哋選擇嘅生活。", Nepali: "अपाङ्गता भएका व्यक्तिहरूलाई उनीहरूले रोजेको जीवन जिउन सहयोग गर्दछ।", Italian: "Sostiene le persone con disabilità a vivere la vita che scelgono." }, address: "Level 2, Suite 2, 12 Butler Road, Hurstville", phone: "1800 818 286", email: "northcott@northcott.com.au", website: "https://northcott.com.au/" },
                { name: "The ORS Group", lat: -33.967, lng: 151.104, community: "Disability Services", languages: ["English"], description: { English: "Employment and training services for people with disabilities.", Mandarin: "为残疾人士提供就业和培训服务。", Greek: "Υπηρεσίες απασχόλησης και κατάρτισης για άτομα με αναπηρίες.", Cantonese: "為殘疾人士提供就業同培訓服務。", Nepali: "अपाङ्गता भएका व्यक्तिहरूका लागि रोजगारी र तालिम सेवाहरू।", Italian: "Servizi di impiego e formazione per persone con disabilità." }, address: "Level 1, 430 Forest Road, Hurstville", phone: "1800 000 677", email: "ors@orsgroup.com.au", website: "https://www.orsgroup.com.au/" },
                // Domestic Violence
                { name: "Enough is Enough", lat: null, lng: null, community: "Domestic Violence", languages: ["English"], description: { English: "Anti-violence and support services.", Mandarin: "反暴力和支持服务。", Greek: "Υπηρεσίες κατά της βίας και υποστήριξης.", Cantonese: "反暴力同支援服務。", Nepali: "हिंसा विरोधी र समर्थन सेवाहरू।", Italian: "Servizi di supporto e anti-violenza." }, address: "N/A", phone: "(02) 9542 4029", email: "team@enoughisenough.org.au", website: "https://www.enoughisenough.org.au/" },
                { name: "1800RESPECT", lat: null, lng: null, community: "Domestic Violence", languages: ["English"], description: { English: "National sexual assault, domestic family violence counselling service.", Mandarin: "国家性侵犯、家庭暴力咨询服务。", Greek: "Εθνική υπηρεσία συμβουλευτικής για τη σεξουαλική επίθεση και την ενδοοικογενειακή βία.", Cantonese: "全國性侵犯、家庭暴力輔導服務。", Nepali: "राष्ट्रिय यौन दुर्व्यवहार, घरेलु पारिवारिक हिंसा परामर्श सेवा।", Italian: "Servizio nazionale di consulenza sulla violenza sessuale e domestica." }, address: "N/A", phone: "1800 737 732", email: "N/A", website: "https://www.1800respect.org.au/" },
                // Drug & Alcohol
                { name: "2Connect – READY Youth Drug Support", lat: -33.955, lng: 151.156, community: "Drug & Alcohol", languages: ["English"], description: { English: "Drug and alcohol support for young people.", Mandarin: "为年轻人提供药物和酒精支持。", Greek: "Υποστήριξη για τα ναρκωτικά και το αλκοόλ για νέους.", Cantonese: "為年輕人提供藥物同酒精支援。", Nepali: "युवाहरूका लागि लागूपदार्थ र मदिरा समर्थन।", Italian: "Supporto per droghe e alcol per i giovani." }, address: "Corner of Moate Avenue & Princess Street, Brighton Le Sands", phone: "(02) 9556 1769", email: "ready@2connect.org.au", website: "https://2connect.org.au/" },
                // Education, Training & Employment
                { name: "St George Careers Development Centre", lat: -33.967, lng: 151.104, community: "Education, Training & Employment", languages: ["English"], description: { English: "Career advice and development services.", Mandarin: "职业建议和发展服务。", Greek: "Υπηρεσίες επαγγελματικού προσανατολισμού και ανάπτυξης.", Cantonese: "職業建議同發展服務。", Nepali: "क्यारियर सल्लाह र विकास सेवाहरू।", Italian: "Servizi di consulenza e sviluppo professionale." }, address: "2 Rose Street, Hurstville", phone: "(02) 9570 7577", email: "sgcdc@bigpond.net.au", website: "http://www.sgcdc.com.au/" },
                { name: "MTC Recruitment", lat: -33.967, lng: 151.104, community: "Education, Training & Employment", languages: ["English"], description: { English: "Recruitment and training services.", Mandarin: "招聘和培训服务。", Greek: "Υπηρεσίες πρόσληψης και εκπαίδευσης.", Cantonese: "招聘同培訓服務。", Nepali: "भर्ती र तालिम सेवाहरू।", Italian: "Servizi di reclutamento e formazione." }, address: "Level 4, 4-8 Woodville Street, Hurstville", phone: "1300 232 663", email: "info@mtcaustralia.com.au", website: "https://www.mtcaustralia.com.au/" },
                // Food & Emergency Support
                { name: "Kogarah Storehouse", lat: -33.965, lng: 151.133, community: "Food & Emergency Support", languages: ["English"], description: { English: "Provides food and financial assistance.", Mandarin: "提供食物和经济援助。", Greek: "Παρέχει τρόφιμα και οικονομική βοήθεια.", Cantonese: "提供食物同經濟援助。", Nepali: "खाद्य र आर्थिक सहायता प्रदान गर्दछ।", Italian: "Fornisce cibo e assistenza finanziaria." }, address: "Cnr Grey and Kensington Street, Kogarah", phone: "(02) 9587 5761", email: "enquiries@kogarahstorehouse.org.au", website: "https://thekogarahstorehouse.org.au/" },
                { name: "Salvation Army Hurstville", lat: -33.967, lng: 151.104, community: "Food & Emergency Support", languages: ["English"], description: { English: "Emergency relief and community support.", Mandarin: "紧急救援和社区支持。", Greek: "Έκτακτη ανακούφιση και κοινοτική υποστήριξη.", Cantonese: "緊急救援同社區支援。", Nepali: "आपतकालीन राहत र सामुदायिक समर्थन।", Italian: "Soccorso d'emergenza e supporto comunitario." }, address: "Cnr Bond and Dore Streets, Hurstville", phone: "(02) 9570 2617", email: "hurstvillesalvos@salvationarmy.org.au", website: "https://www.salvationarmy.org.au/hurstville" },
                // Government Departments
                { name: "Sutherland Shire Council", lat: -34.033, lng: 151.05, community: "Government Departments", languages: ["English"], description: { English: "Local government services.", Mandarin: "地方政府服务。", Greek: "Υπηρεσίες τοπικής αυτοδιοίκησης.", Cantonese: "地方政府服務。", Nepali: "स्थानीय सरकारी सेवाहरू।", Italian: "Servizi del governo locale." }, address: "4-20 Eton Street, Sutherland", phone: "(02) 9710 0333", email: "ssc@ssc.nsw.gov.au", website: "https://www.sutherlandshire.nsw.gov.au/" },
                { name: "Bayside Council", lat: -33.96, lng: 151.15, community: "Government Departments", languages: ["English"], description: { English: "Local government services.", Mandarin: "地方政府服务。", Greek: "Υπηρεσίες τοπικής αυτοδιοίκησης.", Cantonese: "地方政府服務。", Nepali: "स्थानीय सरकारी सेवाहरू।", Italian: "Servizi del governo locale." }, address: "444-446 Princes Highway, Rockdale", phone: "1300 581 299", email: "council@bayside.nsw.gov.au", website: "https://www.bayside.nsw.gov.au/" },
                // Health & Wellbeing
                { name: "Headspace Hurstville", lat: -33.967, lng: 151.104, community: "Health & Wellbeing", languages: ["English"], description: { English: "Youth mental health services.", Mandarin: "青年心理健康服务。", Greek: "Υπηρεσίες ψυχικής υγείας για νέους.", Cantonese: "青年心理健康服務。", Nepali: "युवा मानसिक स्वास्थ्य सेवाहरू।", Italian: "Servizi di salute mentale per i giovani." }, address: "41 Dora Street, Hurstville", phone: "(02) 8048 3350", email: "headspace.hurstville@stride.com.au", website: "https://headspace.org.au/headspace-centres/hurstville/" },
                { name: "Lifeline", lat: null, lng: null, community: "Health & Wellbeing", languages: ["English"], description: { English: "24/7 crisis support and suicide prevention.", Mandarin: "24/7 危机支持和自杀预防。", Greek: "24/7 υποστήριξη κρίσεων και πρόληψη αυτοκτονιών.", Cantonese: "24/7 危機支援同自殺預防。", Nepali: "24/7 संकट समर्थन र आत्महत्या रोकथाम।", Italian: "Supporto per le crisi 24/7 e prevenzione del suicidio." }, address: "N/A", phone: "13 11 14", email: "N/A", website: "https://www.lifeline.org.au/" },
                // Housing & Homelessness
                { name: "St George Community Housing", lat: -33.967, lng: 151.104, community: "Housing & Homelessness", languages: ["English"], description: { English: "Community housing provider.", Mandarin: "社区住房提供者。", Greek: "Πάροχος κοινοτικής στέγασης.", Cantonese: "社區房屋提供者。", Nepali: "सामुदायिक आवास प्रदायक।", Italian: "Fornitore di alloggi comunitari." }, address: "Level 5, 38 Humphreys Lane, Hurstville", phone: "1800 573 370", email: "office@sgch.com.au", website: "https://www.sgch.com.au/" },
                // Legal Support
                { name: "Justice Support Centre", lat: -33.92, lng: 151.03, community: "Legal Support", languages: ["English"], description: { English: "Support for victims of crime.", Mandarin: "为犯罪受害者提供支持。", Greek: "Υποστήριξη για θύματα εγκλημάτων.", Cantonese: "為犯罪受害者提供支援。", Nepali: "अपराध पीडितहरूका लागि समर्थन।", Italian: "Supporto per le vittime di reati." }, address: "Level 4, 2-14 Meredith Street, Bankstown", phone: "(02) 9601 7777", email: "info@justicesupportcentre.org", website: "https://www.justicesupportcentre.org.au/" },
                // LGBTQIA+
                { name: "ACON", lat: -33.88, lng: 151.21, community: "LGBTQIA+", languages: ["English"], description: { English: "Health promotion organisation for LGBTQIA+ people.", Mandarin: "为 LGBTQIA+ 人士提供健康促进的组织。", Greek: "Οργανισμός προαγωγής της υγείας για άτομα LGBTQIA+.", Cantonese: "為 LGBTQIA+ 人士提供健康促進嘅組織。", Nepali: "LGBTQIA+ व्यक्तिहरूका लागि स्वास्थ्य प्रवर्द्धन संस्था।", Italian: "Organizzazione per la promozione della salute per le persone LGBTQIA+." }, address: "414 Elizabeth Street, Surry Hills", phone: "1800 063 060", email: "acon@acon.org.au", website: "https://www.acon.org.au/" },
                // Multicultural
                { name: "Advance Diversity Services", lat: -33.967, lng: 151.104, community: "Multicultural", languages: ["English"], description: { English: "Services for culturally and linguistically diverse communities.", Mandarin: "为文化和语言多样化的社区提供服务。", Greek: "Υπηρεσίες για πολιτισμικά και γλωσσικά διαφορετικές κοινότητες.", Cantonese: "為文化同語言多元化嘅社區提供服務。", Nepali: "सांस्कृतिक र भाषिक रूपमा विविध समुदायहरूका लागि सेवाहरू।", Italian: "Servizi per comunità culturalmente e linguisticamente diverse." }, address: "Suite 231 & 232 (Building 2/Level 3), 7-11 The Avenue, Hurstville", phone: "(02) 9597 5455", email: "info@advancediversity.org.au", website: "https://www.advancediversity.org.au/" },
                // Police & Emergency Services
                { name: "Hurstville Police Station", lat: -33.967, lng: 151.104, community: "Police & Emergency Services", languages: ["English"], description: { English: "Local police station.", Mandarin: "当地警察局。", Greek: "Τοπικό αστυνομικό τμήμα.", Cantonese: "當地警察局。", Nepali: "स्थानीय प्रहरी चौकी।", Italian: "Stazione di polizia locale." }, address: "36/38 Ormonde Parade, Hurstville", phone: "(02) 9375 8599", email: "N/A", website: "https://www.police.nsw.gov.au/" },
                // Seniors
                { name: "3Bridges Community", lat: -33.98, lng: 151.11, community: "Seniors", languages: ["English"], description: { English: "Aged care and community services.", Mandarin: "老年护理和社区服务。", Greek: "Φροντίδα ηλικιωμένων και κοινοτικές υπηρεσίες.", Cantonese: "老年護理同社區服務。", Nepali: "वृद्ध हेरचाह र सामुदायिक सेवाहरू।", Italian: "Assistenza agli anziani e servizi comunitari." }, address: "1/72 Carwar Avenue, Carss Park", phone: "1300 327 434", email: "admin@3bridges.org.au", website: "https://3bridges.org.au/" },
                // Transport
                { name: "St George Cabs", lat: null, lng: null, community: "Transport", languages: ["English"], description: { English: "Local taxi service.", Mandarin: "当地出租车服务。", Greek: "Τοπική υπηρεσία ταξί.", Cantonese: "當地的士服務。", Nepali: "स्थानीय ट्याक्सी सेवा।", Italian: "Servizio taxi locale." }, address: "N/A", phone: "132 166", email: "enquiries@stgeorgecabs.com.au", website: "https://www.stgeorgecabs.com.au/" },
                // Youth
                { name: "PCYC St George", lat: -33.95, lng: 151.15, community: "Youth", languages: ["English"], description: { English: "Youth and community programs.", Mandarin: "青年和社区项目。", Greek: "Προγράμματα για νέους και την κοινότητα.", Cantonese: "青年同社區計劃。", Nepali: "युवा र सामुदायिक कार्यक्रमहरू।", Italian: "Programmi per i giovani e la comunità." }, address: "McCarthy Reserve, 9 Ador Avenue, Rockdale", phone: "(02) 9567 0408", email: "stgeorge@pcycnsw.org.au", website: "https://www.pcycnsw.org.au/st-george" }
        ];
        
        const translations = {
            "English": { "titleFind": "Find ", "titleResources": " resources", "titleAtTheLibrary": "at the library", "headingSelectLanguage": "Select your language:", "headingChooseCategory": "Choose a Category:", "listHeader": "Service Directory", "labelAddress": "Address:", "labelPhone": "Phone:", "labelEmail": "Email:", "catFirstNations": "First Nations", "catArts": "Arts", "catCarers": "Carers Support Services", "catChildrenFamilies": "Children & Families", "catCommunitySupport": "Community Support", "catDisability": "Disability Services", "catDomesticViolence": "Domestic Violence", "catDrugAlcohol": "Drug & Alcohol", "catEducation": "Education, Training & Employment", "catFood": "Food & Emergency Support", "catGovernment": "Government Departments", "catHealth": "Health & Wellbeing", "catHousing": "Housing & Homelessness", "catLegal": "Legal Support", "catLgbtqia": "LGBTQIA+", "catMulticultural": "Multicultural", "catPolice": "Police & Emergency Services", "catSeniors": "Seniors", "catTransport": "Transport", "catYouth": "Youth" },
            "Mandarin": { "titleFind": "查找", "titleResources": "资源", "titleAtTheLibrary": "在图书馆", "headingSelectLanguage": "选择你的语言:", "headingChooseCategory": "选择一个类别:", "listHeader": "服务目录", "labelAddress": "地址:", "labelPhone": "电话:", "labelEmail": "电子邮件:", "catFirstNations": "原住民服务", "catArts": "艺术", "catCarers": "照顾者支持服务", "catChildrenFamilies": "儿童与家庭", "catCommunitySupport": "社区支持", "catDisability": "残疾人服务", "catDomesticViolence": "家庭暴力", "catDrugAlcohol": "药物和酒精", "catEducation": "教育、培训和就业", "catFood": "食品和紧急支持", "catGovernment": "政府部门", "catHealth": "健康与福祉", "catHousing": "住房与无家可归", "catLegal": "法律支持", "catLgbtqia": "LGBTQIA+ 社区", "catMulticultural": "多元文化", "catPolice": "警察和紧急服务", "catSeniors": "老年人", "catTransport": "交通", "catYouth": "青年" },
            "Cantonese": { "titleFind": "搵", "titleResources": "資源", "titleAtTheLibrary": "喺圖書館", "headingSelectLanguage": "選擇你的語言:", "headingChooseCategory": "選擇一個類別:", "listHeader": "服務目錄", "labelAddress": "地址:", "labelPhone": "電話:", "labelEmail": "電子郵件:", "catFirstNations": "原住民服務", "catArts": "藝術", "catCarers": "照顧者支援服務", "catChildrenFamilies": "兒童與家庭", "catCommunitySupport": "社區支援", "catDisability": "殘疾人服務", "catDomesticViolence": "家庭暴力", "catDrugAlcohol": "藥物和酒精", "catEducation": "教育、培訓和就業", "catFood": "食品和緊急支援", "catGovernment": "政府部門", "catHealth": "健康與福祉", "catHousing": "住房與無家可歸", "catLegal": "法律支援", "catLgbtqia": "LGBTQIA+ 社區", "catMulticultural": "多元文化", "catPolice": "警察和緊急服務", "catSeniors": "長者", "catTransport": "交通", "catYouth": "青年" },
            "Nepali": { "titleFind": "खोज्नुहोस्", "titleResources": "स्रोतहरू", "titleAtTheLibrary": "पुस्तकालयमा", "headingSelectLanguage": "आफ्नो भाषा छान्नुहोस्:", "headingChooseCategory": "एउटा श्रेणी छान्नुहोस्:", "listHeader": "सेवा निर्देशिका", "labelAddress": "ठेगाना:", "labelPhone": "फोन:", "labelEmail": "इमेल:", "catFirstNations": "प्रथम राष्ट्र", "catArts": "कला", "catCarers": "हेरचाहकर्ता समर्थन सेवाहरू", "catChildrenFamilies": "बालबालिका र परिवारहरू", "catCommunitySupport": "सामुदायिक समर्थन", "catDisability": "अपाङ्गता सेवाहरू", "catDomesticViolence": "घरेलु हिंसा", "catDrugAlcohol": "लागुपदार्थ र मदिरा", "catEducation": "शिक्षा, तालिम र रोजगार", "catFood": "खाद्य र आपतकालीन समर्थन", "catGovernment": "सरकारी विभागहरू", "catHealth": "स्वास्थ्य र कल्याण", "catHousing": "आवास र घरबारविहीनता", "catLegal": "कानूनी समर्थन", "catLgbtqia": "LGBTQIA+ समुदायहरू", "catMulticultural": "बहुसांस्कृतिक", "catPolice": "प्रहरी र आपतकालीन सेवाहरू", "catSeniors": "ज्येष्ठ नागरिक", "catTransport": "यातायात", "catYouth": "युवा" },
            "Italian": { "titleFind": "Trova", "titleResources": "risorse", "titleAtTheLibrary": "in biblioteca", "headingSelectLanguage": "Seleziona la tua lingua:", "headingChooseCategory": "Scegli una categoria:", "listHeader": "Elenco dei servizi", "labelAddress": "Indirizzo:", "labelPhone": "Telefono:", "labelEmail": "E-mail:", "catFirstNations": "Prime Nazioni", "catArts": "Arte", "catCarers": "Servizi di supporto per i caregiver", "catChildrenFamilies": "Bambini e famiglie", "catCommunitySupport": "Supporto comunitario", "catDisability": "Servizi per la disabilità", "catDomesticViolence": "Violenza domestica", "catDrugAlcohol": "Droghe e alcol", "catEducation": "Istruzione, formazione e impiego", "catFood": "Cibo e supporto di emergenza", "catGovernment": "Dipartimenti governativi", "catHealth": "Salute e benessere", "catHousing": "Alloggio e senzatetto", "catLegal": "Supporto legale", "catLgbtqia": "Comunità LGBTQIA+", "catMulticultural": "Multiculturale", "catPolice": "Polizia e servizi di emergenza", "catSeniors": "Anziani", "catTransport": "Trasporti", "catYouth": "Gioventù" },
            "Greek": { "titleFind": "Βρείτε", "titleResources": "πόρους", "titleAtTheLibrary": "στη βιβλιοθήκη", "headingSelectLanguage": "Επιλέξτε τη γλώσσα σας:", "headingChooseCategory": "Επιλέξτε μια κατηγορία:", "listHeader": "Κατάλογος Υπηρεσιών", "labelAddress": "Διεύθυνση:", "labelPhone": "Τηλέφωνο:", "labelEmail": "Ηλεκτρονική Διεύθυνση:", "catFirstNations": "Υπηρεσίες Πρώτων Εθνών", "catArts": "Τέχνες", "catCarers": "Υπηρεσίες Υποστήριξης Φροντιστών", "catChildrenFamilies": "Παιδιά & Οικογένειες", "catCommunitySupport": "Κοινοτική Υποστήριξη", "catDisability": "Υπηρεσίες Αναπηρίας", "catDomesticViolence": "Ενδοοικογενειακή Βία", "catDrugAlcohol": "Ναρκωτικά & Αλκοόλ", "catEducation": "Εκπαίδευση, Κατάρτιση & Απασχόληση", "catFood": "Τρόφιμα & Έκτακτη Ανάγκη", "catGovernment": "Κυβερνητικές Υπηρεσίες", "catHealth": "Υγεία & Ευεξία", "catHousing": "Στέγαση & Αστεγία", "catLegal": "Νομική Υποστήριξη", "catLgbtqia": "Κοινότητες LGBTQIA+", "catMulticultural": "Πολυπολιτισμικό", "catPolice": "Αστυνομία & Υπηρεσίες Έκτακτης Ανάγκης", "catSeniors": "Ηλικιωμένοι", "catTransport": "Μεταφορές", "catYouth": "Νεολαία" }
        };


        // --- MAP INITIALIZATION ---
        const map = L.map('map').setView([-33.97, 151.08], 11); // Zoomed out slightly
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        const markerLayer = L.layerGroup().addTo(map);
        const languageFilters = document.getElementById('language-filters');
        const communityFilters = document.getElementById('community-filters');
        const organisationList = document.getElementById('organisation-list');
        const listHeader = document.getElementById('list-header');
        const scrollingCategory = document.getElementById('scrolling-category');
        
        let selectedLanguage = 'English';
        let selectedCommunity = 'First Nations';
        let originalTexts = {};

        // --- SCROLLING TITLE LOGIC ---
        const titles = [
            "a community", "First Nations", "Arts", "Carers Support", "Children & Families",
            "Community Support", "Disability Services", "Domestic Violence", "Drug & Alcohol",
            "Food & Emergency Support",
            "Government Departments", "Health & Wellbeing", "Housing & Homelessness",
            "Legal Support", "LGBTQIA+", "Multicultural",
            "Police & Emergency Services", "Seniors", "Transport", "Youth"
        ];
        let titleIndex = 0;

        function setInitialTitle() {
            if (scrollingCategory) {
                scrollingCategory.innerHTML = titles[0];
            }
        }

        function scrollTitle() {
            titleIndex = (titleIndex + 1) % titles.length;
            if (scrollingCategory) {
                scrollingCategory.style.opacity = 0;
                setTimeout(() => {
                    const titleKey = titles[titleIndex];
                    const currentTranslations = translations[selectedLanguage] || translations['English'];
                    const categoryKey = "cat" + titleKey.replace(/ & /g, '').replace(/ /g, '');
                    scrollingCategory.innerHTML = currentTranslations[categoryKey] || titleKey;
                    scrollingCategory.style.opacity = 1;
                }, 500);
            }
        }
        
        // --- HELPER FUNCTION TO GENERATE QR CODE ---
        function generateQrCode(url) {
            try {
                const qr = qrcode(0, 'L');
                qr.addData(url);
                qr.make();
                return qr.createImgTag(4, 8); // cell size, margin
            } catch (e) {
                console.error('QR Code generation failed:', e);
                return '<span>QR code error.</span>';
            }
        }
        
        // --- TRANSLATION LOGIC ---
        function storeOriginalTexts() {
            document.querySelectorAll('[data-translate-key]').forEach(el => {
                originalTexts[el.dataset.translateKey] = el.innerText;
            });
        }

        function applyTranslations(language) {
             const translationSet = translations[language] || translations['English'];
             document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.dataset.translateKey;
                el.innerText = translationSet[key];
             });
             updateDisplay();
        }

        function updateDisplay() {
            // Clear existing markers and list items
            markerLayer.clearLayers();
            organisationList.innerHTML = '';
            
            const currentTranslations = translations[selectedLanguage] || translations['English'];
            listHeader.textContent = currentTranslations.listHeader;
            
            const filteredPartners = partners.filter(p => {
                const languageMatch = p.languages.includes(selectedLanguage) || p.languages.includes('English');
                const communityMatch = p.community === selectedCommunity;
                return languageMatch && communityMatch;
            });

            if (filteredPartners.length === 0) {
                organisationList.innerHTML = `<li class="organisation-item"><p>${currentTranslations.noServicesFound || 'No services found for this category.'}</p></li>`;
            }

            const uniquePartners = [...new Map(filteredPartners.map(item => [item['name'], item])).values()];

            uniquePartners.forEach((partner, index) => {
                const description = (partner.description[selectedLanguage] || partner.description['English']);
                const emailHTML = (partner.email && partner.email !== "N/A") 
                    ? `<p><strong>${currentTranslations.labelEmail}</strong> <a href="mailto:${partner.email}">${partner.email}</a></p>`
                    : '';

                // Add item to the list below the map
                const listItem = document.createElement('li');
                listItem.className = 'organisation-item';
                listItem.innerHTML = `
                    <div class="item-details">
                        <h3>${partner.name}</h3>
                        <p class="item-description">${description}</p>
                        <p><strong>${currentTranslations.labelAddress}</strong> ${partner.address}</p>
                        <p><strong>${currentTranslations.labelPhone}</strong> ${partner.phone}</p>
                        ${emailHTML}
                    </div>
                    <div class="item-qr-code">${generateQrCode(partner.website)}</div>
                `;
                organisationList.appendChild(listItem);

                // Add marker to the map only if lat/lng are available
                if (partner.lat && partner.lng) {
                    const marker = L.marker([partner.lat, partner.lng]).addTo(markerLayer);
                    
                    const popupQrCodeId = `popup-qrcode-${index}`;
                    const popupContent = `
                        <h3>${partner.name}</h3>
                        <p class="popup-description">${description}</p>
                        <div class="popup-details">
                            <p><strong>${currentTranslations.labelAddress}</strong> ${partner.address}</p>
                            <p><strong>${currentTranslations.labelPhone}</strong> ${partner.phone}</p>
                            ${emailHTML}
                        </div>
                        <div class="popup-qr-code" id="${popupQrCodeId}"></div>
                    `;
                    marker.bindPopup(popupContent);

                    // Generate QR code when the popup is opened
                    marker.on('popupopen', () => {
                        const qrContainer = document.getElementById(popupQrCodeId);
                        if(qrContainer) {
                            qrContainer.innerHTML = generateQrCode(partner.website);
                        }
                    });
                }
            });
        }

        function setupFilterButtons(container, filterType) {
            container.addEventListener('click', (e) => {
                const button = e.target.closest('button');
                if (button) {
                    const filterValue = button.getAttribute('data-filter');
                    
                    if (container.querySelector('.active')) {
                        container.querySelector('.active').classList.remove('active');
                    }
                    button.classList.add('active');
                    
                    if (filterType === 'language') {
                        selectedLanguage = filterValue;
                        applyTranslations(selectedLanguage);
                    } else if (filterType === 'community') {
                        selectedCommunity = filterValue;
                        updateDisplay();
                    }
                }
            });
        }

        // --- INITIAL SETUP ---
        storeOriginalTexts();
        setInitialTitle();
        setInterval(scrollTitle, 3000);
        setupFilterButtons(languageFilters, 'language');
        setupFilterButtons(communityFilters, 'community');
        applyTranslations('English'); // Apply initial English text
        });
    </script>
</body>
</html>
